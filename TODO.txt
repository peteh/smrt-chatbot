Clean up code and handle errors
move pipelines in separate files